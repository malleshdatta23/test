import sys
# sys.path.append('/home/airflow/gcs/dags/vz-it-gk1v-edwdo-0/')
sys.path.append('/home/airflow/gcs/dags/vz-it-gk1v-edwdo-0/informatica/aedw-mdr-dw-ssp-datamart-edm')
import airflow
from airflow import DAG
from datetime import datetime, timedelta
from airflow.models import Variable
from airflow.utils.db import provide_session
from airflow.operators.dummy import DummyOperator
from airflow.operators.trigger_dagrun import TriggerDagRunOperator
from airflow.decorators import task
from airflow.providers.ssh.operators.ssh import SSHOperator
from airflow.providers.ssh.hooks.ssh import SSHHook
from airflow.providers.sftp.sensors.sftp import SFTPSensor
from airflow.utils.task_group import TaskGroup
# from MDR_SSP.Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS.taskGroups.Wklt_EDM_DW_ALL_OTHER_DIMENSIONS.Wklt_EDM_DW_ALL_OTHER_DIMENSIONS import *
# from MDR_SSP.Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS.taskGroups.Wklt_EDM_DW_FiOS_BOOKSHELF.Wklt_EDM_DW_FiOS_BOOKSHELF import *
# from MDR_SSP.Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS.taskGroups.Wklt_EDM_DW_SSP_BIZ_BUNDLES.Wklt_EDM_DW_SSP_BIZ_BUNDLES import *
from wkfl_edm_dw_all_other_dimensions.taskgroups.wklt_edm_dw_all_other_dimensions.wklt_edm_dw_all_other_dimensions import *
from wkfl_edm_dw_all_other_dimensions.taskgroups.wklt_edm_dw_fios_bookshelf.wklt_edm_dw_fios_bookshelf import *
from wkfl_edm_dw_all_other_dimensions.taskgroups.wklt_edm_dw_ssp_biz_bundles.wklt_edm_dw_ssp_biz_bundles import *
from operators.dm_status import DMStatusOperator
import logging
import os
from datetime import datetime, timedelta
from airflow.models import Variable
from airflow.providers.google.cloud.hooks.bigquery import BigQueryHook
from airflow.exceptions import AirflowFailException
from airflow.sensors.python import PythonSensor
from airflow.operators.python import PythonOperator
from airflow.providers.google.cloud.hooks.gcs import GCSHook
import tempfile
from airflow.utils.email import send_email

GCS_OUTBOUND = Variable.get('GCS_OUTBOUND')
GCP_CONN_ID = Variable.get('GCP_CONNECTION_ID')


def create_touch_file(object_name, **context):
    project_id = Variable.get("BQ_ProjectID")
    

    hook = GCSHook(gcp_conn_id=GCP_CONN_ID)

    credentials = hook.get_credentials()
    credentials.project = project_id
    logging.info(f"Set GCSHook project context to: {project_id}")
    GCS_BUCKET = GCS_OUTBOUND.replace('gs://', '')

    
    hook.upload(
        bucket_name=GCS_BUCKET,
        object_name=object_name,
        data="",
        mime_type = 'text/plain'
    )

# def edm_dw_generate_par(load_type='REGULAR', inp_param=None, **context):
#     GCS_DATA_DIR = '/home/airflow/gcs/data/'
#     BIN_DIR = os.path.join(GCS_DATA_DIR, 'ETL_SCRIPTS/SSP_DM_DIM/Bin')
#     PARA_DIR = os.path.join(GCS_DATA_DIR, 'ETL_SCRIPTS/SSP_DM_DIM/Params')
    
#     start_date = None
#     end_date = None

#     if load_type.upper() == 'BULK':
#         if inp_param is not None and str(inp_param).isdigit():
#             start_day = int(inp_param) + 1
#             end_day = int(inp_param)
#             today = datetime.now()
#             start_date = (today - timedelta(days=start_day)).strftime('%m/%d/%Y')
#             end_date = (today - timedelta(days=end_day)).strftime('%m/%d/%Y')
#         else:
#             start_date = (datetime.now() - timedelta(days=1)).strftime('%m/%d/%Y')
#             end_date = datetime.now().strftime('%m/%d/%Y')
            
#     elif load_type.upper() == 'REGULAR':
#         rptg_dt_file = os.path.join(BIN_DIR, "Rptg_dt.txt")
#         if os.path.exists(rptg_dt_file):
#             with open(rptg_dt_file, 'r') as f:
#                 rptg_dt_str = f.read().strip() 
            
#             rptg_dt = datetime.strptime(rptg_dt_str, '%m/%d/%Y')
#             start_date = (rptg_dt + timedelta(days=1)).strftime('%m/%d/%Y')
#             end_date = (rptg_dt + timedelta(days=2)).strftime('%m/%d/%Y')
#         else:
#             logging.warning("Rptg_dt.txt not found, defaulting to current date offsets.")
#             start_date = (datetime.now() - timedelta(days=1)).strftime('%m/%d/%Y')
#             end_date = datetime.now().strftime('%m/%d/%Y')

#     logging.info(f"LOAD_TYPE: {load_type} | START_DATE: {start_date} | END_DATE: {end_date}")

#     ini_file_path = os.path.join(BIN_DIR, 'edm_dw_par_teradata.ini')
#     par_file_path = os.path.join(PARA_DIR, 'edm_dw_mig.par')

#     if not os.path.exists(ini_file_path):
#         raise FileNotFoundError(f"Configuration file {ini_file_path} does not exist.")

#     with open(ini_file_path, 'r') as ini_file:
#         lines = ini_file.readlines()

#     par_content = []
#     for line in lines:
#         if line.strip():
#             parts = line.strip().split('-')
#             section_header = parts[0]
#             par_content.append(f"[{section_header}]")
            
#             for param in parts[1:]:
#                 par_content.append(param)
            
#             par_content.append(f"$$START_DATE={start_date}")
#             par_content.append(f"$$END_DATE={end_date}")
#             par_content.append("") 

#     os.makedirs(PARA_DIR, exist_ok=True)
#     with open(par_file_path, 'w') as par_file:
#         par_file.write("\n".join(par_content))

def edm_dw_generate_par(load_type='REGULAR', inp_param=None, **context):
    # Configuration
    BUCKET_NAME = 'wdwg-ple-aidcom-0-usre-composer-edw-wln-metric-1'
    # Using lowercase paths based on your GS URI
    BIN_DIR = 'etl_scripts/ssp_dm_dim/bin'
    PARA_DIR = 'etl_scripts/ssp_dm_dim/params'
    
    gcs_hook = GCSHook(gcp_conn_id='google_cloud_default')
    
    start_date = None
    end_date = None

    if load_type.upper() == 'BULK':
        if inp_param is not None and str(inp_param).isdigit():
            start_day = int(inp_param) + 1
            end_day = int(inp_param)
            today = datetime.now()
            start_date = (today - timedelta(days=start_day)).strftime('%m/%d/%Y')
            end_date = (today - timedelta(days=end_day)).strftime('%m/%d/%Y')
        else:
            start_date = (datetime.now() - timedelta(days=1)).strftime('%m/%d/%Y')
            end_date = datetime.now().strftime('%m/%d/%Y')
            
    elif load_type.upper() == 'REGULAR':
        rptg_dt_path = f"{BIN_DIR}/Rptg_dt.txt"
        try:
            # Read Rptg_dt.txt from GCS
            content = gcs_hook.download(bucket_name=BUCKET_NAME, object_name=rptg_dt_path).decode('utf-8')
            rptg_dt_str = content.strip()
            rptg_dt = datetime.strptime(rptg_dt_str, '%m/%d/%Y')
            start_date = (rptg_dt + timedelta(days=1)).strftime('%m/%d/%Y')
            end_date = (rptg_dt + timedelta(days=2)).strftime('%m/%d/%Y')
        except Exception as e:
            logging.warning(f"Rptg_dt.txt not found at gs://{BUCKET_NAME}/{rptg_dt_path} or failed to read. Defaulting to current date offsets. Error: {e}")
            start_date = (datetime.now() - timedelta(days=1)).strftime('%m/%d/%Y')
            end_date = datetime.now().strftime('%m/%d/%Y')

    logging.info(f"LOAD_TYPE: {load_type} | START_DATE: {start_date} | END_DATE: {end_date}")

    # Read INI file from GCS
    ini_file_path = f"{BIN_DIR}/edm_dw_par_teradata.ini"
    try:
        ini_content = gcs_hook.download(bucket_name=BUCKET_NAME, object_name=ini_file_path).decode('utf-8')
    except Exception as e:
        raise AirflowFailException(f"Configuration file gs://{BUCKET_NAME}/{ini_file_path} does not exist or could not be read. Error: {e}")

    # Process Content
    par_content = []
    for line in ini_content.splitlines():
        if line.strip():
            parts = line.strip().split('-')
            section_header = parts[0]
            par_content.append(f"[{section_header}]")
            
            for param in parts[1:]:
                par_content.append(param)
            
            par_content.append(f"$$START_DATE={start_date}")
            par_content.append(f"$$END_DATE={end_date}")
            par_content.append("") 

    final_par_content = "\n".join(par_content)

    # Write Output back to GCS (using a temp file)
    par_file_path = f"{PARA_DIR}/edm_dw_mig.par"
    
    with tempfile.NamedTemporaryFile(mode='w', delete=False) as tmp_file:
        tmp_file.write(final_par_content)
        tmp_path = tmp_file.name
    
    try:
        gcs_hook.upload(bucket_name=BUCKET_NAME, object_name=par_file_path, filename=tmp_path)
        logging.info(f"Successfully generated and uploaded parameter file to gs://{BUCKET_NAME}/{par_file_path}")
    except Exception as e:
        raise AirflowFailException(f"Failed to upload parameter file to GCS. Error: {e}")
    finally:
        if os.path.exists(tmp_path):
            os.remove(tmp_path)

# def check_gcs_object_existance(full_object_path, **context):
#     GCS_DATA_PATH = '/home/airflow/gcs/data/'
    
#     target_path = os.path.join(GCS_DATA_PATH, full_object_path)
    
#     if os.path.exists(target_path):
#         logging.info(f"SUCCESS: Object found at {target_path}")
#         return True
    
#     logging.info(f"WAITING: Object {target_path} not found. Will retry...")
#     return False
def check_gcs_object_existance(full_object_path, **context):
    # Configuration
    BUCKET_NAME = 'wdwg-ple-aidcom-0-usre-composer-edw-wln-metric-1'
    
    # Ensure path is clean (remove leading slash if present)
    object_name = full_object_path.lstrip('/')
    
    gcs_hook = GCSHook(gcp_conn_id='google_cloud_default')
    
    try:
        if gcs_hook.exists(bucket_name=BUCKET_NAME, object_name=object_name):
            logging.info(f"SUCCESS: Object found at gs://{BUCKET_NAME}/{object_name}")
            return True
    except Exception as e:
        # Log error but don't fail immediately (allow retry logic if handled by caller)
        logging.warning(f"Error checking GCS object existence: {e}")
    
    logging.info(f"WAITING: Object gs://{BUCKET_NAME}/{object_name} not found. Will retry...")
    return False


def get_var(dag_id, id, var, tg = None):
    key = dag_id + '_' + str(id)
    if tg != None:
        qualifier = ".".join([key, tg, var])
        return Variable.get(qualifier)
    else:
        qualifier = ".".join([key, var])
        return Variable.get(qualifier)

def get_Status(dag_run, id):
    try:
        status = dag_run.get_task_instance(id).state
        if status == "success":
            return "succeeded"
        if status == "failed":
            return "failed"
        return None
    except Exception:
        return "disabled"

def get_PrevTaskStatus(dag_run, id):
    id = list(dag_run.dag.get_task(id).upstream_task_ids)[0]
    return get_Status(dag_run, id)


# def get_resolved_path(filePath):
#     ssh_id = Variable.get('SSH_CONN_ID')
#     ssh_hook = SSHHook(ssh_conn_id=ssh_id)
#     ssh_client = ssh_hook.get_conn()
    
#     stdin, stdout, stderr = ssh_client.exec_command(f'echo {filePath}')
#     resolved_path = stdout.read().decode().strip()
#     error_output = stderr.read().decode().strip()
#     if not resolved_path or error_output:
#         raise Exception(f"Failed to resolve remote path: {filePath}\nError: {error_output}")
#     ssh_client.close()
#     return resolved_path

# @task
# def VZ_AI_DIM_LOAD_teradata(process_nm: str, sys_cd: str, status: str = None, email: str = None, **context):
#     BQ_PROJECT_ID = Variable.get("BQ_ProjectID")
#     BQ_CONN_ID = Variable.get('GCP_CONNECTION_ID')
#     hook = BigQueryHook(gcp_conn_id=BQ_CONN_ID, use_legacy_sql=False)
    
#     GCS_DATA_PATH = '/home/airflow/gcs/data/'
#     BIN_DIR = os.path.join(GCS_DATA_PATH, 'ETL_SCRIPTS/SSP_DM_DIM/Bin')
#     PARA_DIR = os.path.join(GCS_DATA_PATH, 'ETL_SCRIPTS/SSP_DM_DIM/Params')
#     ARCH_DIR = os.path.join(GCS_DATA_PATH, 'ETL_SCRIPTS/SSP_DM_DIM/Archive')

#     if status is None:
#         logging.info(f"PRE-SESSION: Initializing load for {process_nm} ({sys_cd}).") 

#         query_max_audit_sk_null = f"""
#             SELECT MAX(audit_sk)
#             FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log_dim`
#             WHERE LOWER(sys_cd) = LOWER('{sys_cd}') 
#               AND LOWER(process_nm) = LOWER('{process_nm}') 
#               AND status IS NULL
#             GROUP BY sys_cd
#         """
#         result = hook.get_first(sql=query_max_audit_sk_null)
#         max_audit_sk_null = result[0] if result else None

#         if max_audit_sk_null:
#             logging.info(f"Setting existing NULL status record {max_audit_sk_null} to FAILURE.") 
#             update_fail = f"""
#                 UPDATE `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log_dim`
#                 SET status = 'FAILURE'
#                 WHERE audit_sk = {max_audit_sk_null} AND LOWER(process_nm) = LOWER('{process_nm}')
#             """
#             hook.run(sql=update_fail)

#         query_last_success = f"""
#             SELECT intvl_sk
#             FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log_dim`
#             WHERE audit_sk = (
#                 SELECT MAX(audit_sk)
#                 FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log_dim`
#                 WHERE LOWER(sys_cd) = LOWER('{sys_cd}') 
#                   AND LOWER(process_nm) = LOWER('{process_nm}') 
#                   AND LOWER(status) = LOWER('SUCCESS')
#                 GROUP BY sys_cd) 
#               AND LOWER(process_nm) = LOWER('{process_nm}')
#         """
#         intvl_result = hook.get_first(sql=query_last_success)
#         if not intvl_result:
#             raise AirflowFailException(f"No latest records exist in VZAI_ETL_AUDIT_LOG_DIM for {process_nm} with SUCCESS status.") 
        
#         next_intvl_sk = int(intvl_result[0]) + 1 

#         query_dates = f"""
#             SELECT 
#                 PARSE_DATE('%F', FORMAT_DATE('%F', intvl_start_dt)),
#                 PARSE_DATE('%F', FORMAT_DATE('%F', intvl_end_dt))
#             FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_interval_dim`
#             WHERE intvl_sk_day = {next_intvl_sk}
#         """
#         date_results = hook.get_first(sql=query_dates)
#         if not date_results:
#             raise AirflowFailException(f"Interval {next_intvl_sk} not found in vzai_interval_dim.")
        
#         INTVL_START_DATE = f"{date_results[0]} 00:00:00" 
#         INTVL_END_DATE = f"{date_results[1]} 23:59:59" 

#         query_max_sk = f"SELECT MAX(audit_sk) FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log_dim` WHERE LOWER(process_nm) = LOWER('{process_nm}')"
#         max_sk_res = hook.get_first(sql=query_max_sk)
#         new_audit_sk = (int(max_sk_res[0]) if max_sk_res and max_sk_res[0] is not None else 0) + 1 

#         insert_sql = f"""
#             INSERT INTO `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log_dim`
#             SELECT 
#                 {new_audit_sk} AS audit_sk, 
#                 '{process_nm}' AS process_nm, 
#                 CAST(FORMAT_TIMESTAMP('%F %H:%M:%E6S', CURRENT_DATETIME('America/New_York')) AS DATETIME) AS load_start_dt, 
#                 CAST(NULL AS DATETIME) AS load_end_dt, 
#                 {next_intvl_sk} AS intvl_sk, 
#                 CAST('{INTVL_START_DATE}' AS DATETIME) AS intvl_start_dt, 
#                 CAST('{INTVL_END_DATE}' AS DATETIME) AS intvl_end_dt, 
#                 '{sys_cd}' AS sys_cd, 
#                 CAST(NULL AS STRING) AS load_desc, 
#                 CAST(NULL AS STRING) AS status
#         """
#         hook.run(sql=insert_sql) 

#         query_sessions = f"SELECT * FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_sessions_dim` WHERE LOWER(sys_cd) = LOWER('{sys_cd}')"
#         sessions = hook.get_pandas_df(sql=query_sessions) 

#         param_file_path = os.path.join(PARA_DIR, f"{sys_cd}_sessions.par")
#         with open(param_file_path, 'w') as pf:
#             for _, row in sessions.iterrows():
#                 session_name = row.iloc[0] 
#                 pf.write(f"[{session_name}]\n") 
#                 pf.write(f"$$START_TIME={INTVL_START_DATE}\n") 
#                 pf.write(f"$$END_TIME={INTVL_END_DATE}\n\n") 

#         dt = context['ds_nodash']
#         arch_file = f"{sys_cd}_sessions_{dt}.par"
#         logging.info(f"Parameter file created: {param_file_path}")

#     else:
#         logging.info(f"POST-SESSION: Finalizing {process_nm} with status {status}.") 
        
#         query_active_sk = f"""
#             SELECT MAX(audit_sk) FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log_dim`
#             WHERE LOWER(sys_cd) = LOWER('{sys_cd}') AND LOWER(process_nm) = LOWER('{process_nm}') AND status IS NULL
#         """
#         res = hook.get_first(sql=query_active_sk)
#         active_sk = res[0] if res else None

#         if active_sk:
#             update_post = f"""
#                 UPDATE `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log_dim` SET
#                 status = '{status.upper()}',
#                 load_end_dt = CAST(FORMAT_TIMESTAMP('%F %H:%M:%E6S', CURRENT_DATETIME('America/New_York')) AS DATETIME)
#                 WHERE audit_sk = {active_sk} AND LOWER(process_nm) = LOWER('{process_nm}')
#             """
#             hook.run(sql=update_post) 
#         else:
#             logging.error(f"No prerequisite valid records found for {process_nm} in audit table.")
#             if status.upper() == 'FAILURE':
#                 raise AirflowFailException(f"Load failed for {process_nm}")
@task
def VZ_AI_FACTS_LOAD_teradata(process_nm: str, sys_cd: str, status: str = None, email: str = None, **context):
    
    # --- CONFIGURATION ---
    BQ_PROJECT_ID = Variable.get("BQ_ProjectID")
    BQ_CONN_ID = Variable.get('GCP_CONNECTION_ID')
    BUCKET_NAME = 'wdwg-ple-aidcom-0-usre-composer-edw-wln-metric-1'
    
    hook = BigQueryHook(gcp_conn_id=BQ_CONN_ID, use_legacy_sql=False)
    gcs_hook = GCSHook(gcp_conn_id=BQ_CONN_ID)
    GCS_CONFIG_BUCKET = '/home/airflow/gcs/data/'
    
    logging.info(f"--- STARTING TASK: {process_nm} (Sys: {sys_cd}) ---")
    logging.info(f"Config: Project={BQ_PROJECT_ID}, Bucket={BUCKET_NAME}")

    if status is None:
        logging.info("MODE: PRE-SESSION (Initializing Load)")
        
        # ------------------------------------------------------------
        # 1. AUDIT LOGIC
        # ------------------------------------------------------------
        # Check for NULL (Incomplete) records
        query_max_audit_sk_null = f"""
            SELECT MAX(audit_sk)
            FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log`
            WHERE LOWER(sys_cd) = LOWER('{sys_cd}') 
              AND LOWER(process_nm) = LOWER('{process_nm}') 
              AND status IS NULL
        """
        max_audit_sk_null_result = hook.get_first(sql=query_max_audit_sk_null)
        max_audit_sk_null = max_audit_sk_null_result[0] if max_audit_sk_null_result else None
        
        if max_audit_sk_null:
            logging.warning(f"Found orphaned/incomplete run (audit_sk={max_audit_sk_null}). Marking as FAILURE.")
            update_audit_log_fail = f"""
                UPDATE `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log` 
                SET status = 'FAILURE'
                WHERE audit_sk = {max_audit_sk_null} AND LOWER(process_nm) = LOWER('{process_nm}')
            """
            hook.run(sql=update_audit_log_fail)
        
        # Get Last Successful Interval
        logging.info("Fetching last successful interval...")
        query_intvl_sk = f"""
            SELECT intvl_sk
            FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log`
            WHERE audit_sk = (
                SELECT MAX(audit_sk)
                FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log`
                WHERE LOWER(sys_cd) = LOWER('{sys_cd}') 
                  AND LOWER(process_nm) = LOWER('{process_nm}') 
                  AND LOWER(status) = LOWER('SUCCESS')
            GROUP BY sys_cd) AND LOWER(process_nm) = LOWER('{process_nm}')
        """
        intvl_sk_result = hook.get_first(sql=query_intvl_sk)
        last_intvl_sk = intvl_sk_result[0] if intvl_sk_result else None

        if last_intvl_sk is None:
            logging.error(f"CRITICAL: No previous success found for {process_nm}.")
            raise AirflowFailException(f"No successful records for {process_nm}. Cannot calculate next interval.")
        
        next_intvl_sk = int(last_intvl_sk) + 1 
        logging.info(f"Interval Calculation: Last SK={last_intvl_sk}, Next SK={next_intvl_sk}")

        # Get Dates
        query_dates = f"""
            SELECT
                FORMAT_DATE('%Y-%m-%d', intvl_start_dt),
                FORMAT_DATE('%Y-%m-%d', intvl_end_dt)
            FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_interval_dim`
            WHERE intvl_sk_day = {next_intvl_sk}
        """
        date_results = hook.get_first(sql=query_dates)
        if not date_results:
            logging.error(f"Interval {next_intvl_sk} does not exist in DIM table.")
            raise AirflowFailException(f"Interval {next_intvl_sk} not found in vzai_interval_dim.")
            
        INTVL_START_DATE = f"{date_results[0]} 00:00:00"
        INTVL_END_DATE = f"{date_results[1]} 23:59:59"
        logging.info(f"Date Range Determined: {INTVL_START_DATE} to {INTVL_END_DATE}")

        # Insert New Audit Record
        query_max_audit_sk = f"SELECT MAX(audit_sk) FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log` WHERE LOWER(process_nm) = LOWER('{process_nm}');"
        max_audit_sk_result = hook.get_first(sql=query_max_audit_sk)
        max_val = max_audit_sk_result[0] if max_audit_sk_result and max_audit_sk_result[0] is not None else 0
        new_audit_sk = int(max_val) + 1
        
        logging.info(f"Creating new Audit Record: audit_sk={new_audit_sk}")
        
        insert_audit_log = f"""
            INSERT INTO `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log` (audit_sk, process_nm, load_start_dt, load_end_dt, intvl_sk, intvl_start_dt, intvl_end_dt, sys_cd, status)
            VALUES (
                {new_audit_sk}, 
                '{process_nm}', 
                CAST(FORMAT_TIMESTAMP('%F %H:%M:%E6S', CURRENT_DATETIME('America/New_York')) AS DATETIME), 
                NULL,
                {next_intvl_sk}, 
                PARSE_DATETIME('%Y-%m-%d %H:%M:%S', '{INTVL_START_DATE}'), 
                PARSE_DATETIME('%Y-%m-%d %H:%M:%S', '{INTVL_END_DATE}'), 
                '{sys_cd}', 
                NULL
            )
        """
        hook.run(sql=insert_audit_log)

        # ------------------------------------------------------------
        # 2. FILE PROCESSING (Read via GCS Hook)
        # ------------------------------------------------------------
        connections = {
            '$Param_LGConnectionInsert1': 'DPPDSSPE',
            '$Param_LGConnectionInsert2': 'DPPOODSE',
            '$Param_LGConnectionLoad1': 'DPPDSSPG'
        }
        
        param_file_content = ["[Global]", "\n"]
        param_file_content.extend([f"{k}={v}" for k, v in connections.items()])
        param_file_content.append("\n")
        
        # Paths
        SESSION_INI_PATH = f"Bin/{sys_cd}_par_teradata.ini"
        FULL_SESSION_INT_PATH = os.path.join(GCS_CONFIG_BUCKET, SESSION_INI_PATH)
        GCS_OBJECT_PATH = f"data/Bin/{sys_cd}_par_teradata.ini"

        session_var = {}
        
        try:
            logging.info(f"Attempting to download config from GCS: gs://{BUCKET_NAME}/{GCS_OBJECT_PATH}")
            
            if gcs_hook.exists(bucket_name=BUCKET_NAME, object_name=GCS_OBJECT_PATH):
                file_content_bytes = gcs_hook.download(bucket_name=BUCKET_NAME, object_name=GCS_OBJECT_PATH)
                raw_content = file_content_bytes.decode('utf-8').splitlines()
                
                logging.info(f"Download successful. Parsing {len(raw_content)} lines...")
                
                for line in raw_content:
                    if line.strip():
                        parts = line.split('-')
                        if len(parts) > 0:
                            session_name = parts[0]
                            params = parts[1:]        
                            session_var[session_name] = params
                
                logging.info(f"Successfully parsed {len(session_var)} sessions from config.")
            else:
                logging.warning(f"GCS Object {GCS_OBJECT_PATH} NOT FOUND.")
                raise FileNotFoundError(f"GCS Object {GCS_OBJECT_PATH} not found.")
                    
        except Exception as e:
            logging.warning(f"Reading config failed ({e}). Falling back to creating empty local file at {FULL_SESSION_INT_PATH}.")
            session_var = {}
            os.makedirs(os.path.dirname(FULL_SESSION_INT_PATH), exist_ok=True)
            with open(FULL_SESSION_INT_PATH, 'w', encoding='utf-8') as f:
                f.write("")

        # Build Final Content
        for session_name, params in session_var.items():
            param_file_content.append(f"[{session_name}]")
            param_file_content.extend(params)
            param_file_content.append(f"$$START_TIME={INTVL_START_DATE.replace('/', '-')}")
            param_file_content.append(f"$$END_TIME={INTVL_END_DATE.replace('/', '-')}")
            param_file_content.append("\n")
            
        GCS_PARAM_FILE_PATH = f"ETL_SCRIPTS/SSP_DM_DIM/Params/{sys_cd}_sessions.mig.par"
        FULL_GCS_PARAM_FILE_PATH = os.path.join(GCS_CONFIG_BUCKET, GCS_PARAM_FILE_PATH)

        logging.info(f"Writing final .PAR file to: {FULL_GCS_PARAM_FILE_PATH}")
        os.makedirs(os.path.dirname(FULL_GCS_PARAM_FILE_PATH), exist_ok=True)

        with open(FULL_GCS_PARAM_FILE_PATH, 'w', encoding='utf-8') as f:
            f.write("\n".join(param_file_content))
   
        # Archive Copy
        ds_nodash = context['ds_nodash']
        GCS_ARCH_FILE_PATH = f"ETL_SCRIPTS/SSP_DM_DIM/Archive/{sys_cd}_sessions_{ ds_nodash }.par"
        FULL_GCS_ARCH_FILE_PATH = os.path.join(GCS_CONFIG_BUCKET, GCS_ARCH_FILE_PATH)

        os.makedirs(os.path.dirname(FULL_GCS_ARCH_FILE_PATH), exist_ok=True)

        with open(FULL_GCS_ARCH_FILE_PATH, 'w', encoding='utf-8') as f:
            f.write("\n".join(param_file_content))
  
        logging.info(f"Archived copy created at: {FULL_GCS_ARCH_FILE_PATH}")

    else:
        logging.info(f"MODE: POST-SESSION (Finalizing {status})")
        
        if status.upper() not in ('SUCCESS', 'FAILURE'):
             raise AirflowFailException(f"Invalid Status: {status}")
        
        query_find_active_audit = f"""
            SELECT MAX(audit_sk)
            FROM `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log`
            WHERE LOWER(sys_cd) = LOWER('{sys_cd}') 
              AND LOWER(process_nm) = LOWER('{process_nm}') 
              AND status IS NULL
            GROUP BY sys_cd
        """
        
        active_audit_result = hook.get_first(sql=query_find_active_audit)
        current_audit_sk = active_audit_result[0] if active_audit_result else None
        
        if current_audit_sk:
            logging.info(f"Closing Audit Record {current_audit_sk} with status {status.upper()}")
            
            update_audit_log_end = f"""
                UPDATE `{BQ_PROJECT_ID}.dw_ssp.vzai_etl_audit_log` SET
                status = '{status.upper()}',
                load_end_dt = CAST(FORMAT_TIMESTAMP('%F %H:%M:%E6S', CURRENT_DATETIME('America/New_York')) AS DATETIME)
                WHERE audit_sk = {current_audit_sk} AND LOWER(process_nm) = LOWER('{process_nm}')
            """
            hook.run(sql=update_audit_log_end)
        else:
            e_mess = f"No active/open audit record found for {process_nm} to close."
            logging.error(f"ALERT: {e_mess}")
            
        if status.upper() == 'FAILURE':
            raise AirflowFailException(f"Workflow {process_nm} marked as FAILURE in Audit Log.")
        
default_args = {
    'owner': 'dm',
    'depends_on_past': False,
    'start_date': datetime(2016, 4, 15),
    'email': ['sample@mail.com'],
    'email_on_failure': False,
    'email_on_retry': False,
    'retries': 0,
    'retry_delay': timedelta(minutes=1),
}

with DAG('dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions', schedule_interval=None, catchup=False, render_template_as_native_obj=False, default_args=default_args, user_defined_macros={'get_var': get_var, 'get_Status': get_Status, 'get_PrevTaskStatus': get_PrevTaskStatus}, tags=['LOB:wireline  ', 'Sub_Lob:wireline', 'Program_Name:EDW Modernisation', 'VSAD:gk1v', 'Legacy_Application_Name:Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS_Submit', 'Product_Type:legacy', 'Job_Type:Curation']) as dag:

    Start = DummyOperator(
        task_id = 'Start',
        do_xcom_push = False,
    )

    # dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions_ingestion = TriggerDagRunOperator(
    #     task_id = 'dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions_ingestion',
    #     trigger_dag_id = 'dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions_ingestion',
    #     wait_for_completion = True,
    # )

    dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions_ingestion = DummyOperator(
        task_id = 'dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions_ingestion'
    )
    
    @task.branch(task_id = 'branch_logic_1', trigger_rule = 'none_skipped')
    def fn_branch_logic_1(**context):
        targets = []
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        if ((get_Status(context["dag_run"], "Ew_SAC_EDM_Done")) == "succeeded") or ((get_Status(context["dag_run"], "Ew_SAC_EDM_Done")) == "disabled"):
            targets.append('Cmd_EDM_DW_Generate_par')
        return targets

    branch_logic_1_task = fn_branch_logic_1()

    # Cmd_EDM_DW_Generate_par = SSHOperator(
    #     task_id = 'Cmd_EDM_DW_Generate_par',
    #     ssh_hook = ssh_hook,
    #     command = """$ETL_HOME/ETL_SCRIPTS/SSP_DM_DIM/Bin/CurrDt_teradata.ksh """,
    #     conn_timeout = 60,
    #     get_pty = False,
    #     retries = 0,
    #     cmd_timeout = None,
    #     environment = {
    #       'run_id': "{{ dag_run.run_id | lower | replace(':', '') | replace('+', '') | replace('.', '') | replace('-', '') | replace('T', '') }}",
    #       'instance_name': "{{ var.value.INSTANCE_NAME }}",
    #       'job_id': "{{ dag.dag_id }}",
    #       'task_id': 'cmd_edm_dw_generate_par',
    #       'task_type': 'sshoperator'
    #     },
    #     doc_md = "",
    #     trigger_rule = 'all_success',
    # )

    Cmd_EDM_DW_Generate_par = PythonOperator(
        task_id='Cmd_EDM_DW_Generate_par',
        python_callable=edm_dw_generate_par,
        op_kwargs={
            'load_type': 'BULK', 
            'inp_param': None   
        },
        retries=0,
        trigger_rule='all_success',
    )

    @task.branch(task_id = 'branch_logic_2', trigger_rule = 'none_skipped')
    def fn_branch_logic_2(**context):
        targets = []
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        if ((get_Status(context["dag_run"], "Cmd_EDM_DW_Generate_par")) == "succeeded") or ((get_Status(context["dag_run"], "Cmd_EDM_DW_Generate_par")) == "disabled"):
            targets.append('Event_ODS_EDM_ALL_OTHER')
        return targets

    branch_logic_2_task = fn_branch_logic_2()

    # Event_ODS_EDM_ALL_OTHER = SFTPSensor(
    #     task_id = 'Event_ODS_EDM_ALL_OTHER',
    #     sftp_conn_id = Variable.get('SFTP_CONN_ID'),
    #     path = get_resolved_path("/$PMRootDir/ETL_SCRIPTS/SSP_DM_DIM/Params/ods_edm_all_other_dim_success.dat"),
    #     poke_interval = 60,
    #     deferrable = True,
    #     timeout = 300,
    # )

    # Event_ODS_EDM_ALL_OTHER = PythonSensor(
    #     task_id='Event_ODS_EDM_ALL_OTHER',
    #     python_callable=check_gcs_object_existance,
    #     op_kwargs={
    #         'full_object_path': 'ETL_SCRIPTS/SSP_DM_DIM/Params/ods_edm_all_other_dim_success.dat'
    #     },
    #     poke_interval=60, 
    #     timeout=300,     
    #     mode='poke'
    # )
    Event_ODS_EDM_ALL_OTHER = PythonSensor(
        task_id='Event_ODS_EDM_ALL_OTHER',
        python_callable=check_gcs_object_existance,
        op_kwargs={
            'full_object_path': 'etl_scripts/ssp_dm_dim/params/ods_edm_all_other_dim_success.dat'
        },
        poke_interval=60, 
        timeout=300,      
        mode='poke'
    )
    @task.branch(task_id = 'branch_logic_3', trigger_rule = 'none_skipped')
    def fn_branch_logic_3(**context):
        targets = []
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        if ((get_Status(context["dag_run"], "Event_ODS_EDM_ALL_OTHER")) == "succeeded") or ((get_Status(context["dag_run"], "Event_ODS_EDM_ALL_OTHER")) == "disabled"):
            targets.append('Cmd_PreSession_VZAI_AUDIT_LOAD')
        return targets

    branch_logic_3_task = fn_branch_logic_3()

#     Cmd_PreSession_VZAI_AUDIT_LOAD = SSHOperator(
#         task_id = 'Cmd_PreSession_VZAI_AUDIT_LOAD',
#         ssh_hook = ssh_hook,
#         command = """/usr/bin/ksh $ETL_HOME/ETL_SCRIPTS/SSP_DM_DIM/Bin/VZ_AI_DIM_LOAD_teradata.ksh Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS SSP_DIM
#  """,
#         conn_timeout = 60,
#         get_pty = False,
#         retries = 0,
#         cmd_timeout = None,
#         environment = {
#           'run_id': "{{ dag_run.run_id | lower | replace(':', '') | replace('+', '') | replace('.', '') | replace('-', '') | replace('T', '') }}",
#           'instance_name': "{{ var.value.INSTANCE_NAME }}",
#           'job_id': "{{ dag.dag_id }}",
#           'task_id': 'cmd_presession_vzai_audit_load',
#           'task_type': 'sshoperator'
#         },
#         doc_md = "",
#         trigger_rule = 'all_success',
#     )

    Cmd_PreSession_VZAI_AUDIT_LOAD = VZ_AI_DIM_LOAD_teradata.override(task_id='Cmd_PreSession_VZAI_AUDIT_LOAD', trigger_rule='all_success')(
        process_nm='Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS',
        sys_cd='SSP_DIM'
    )

    @task.branch(task_id = 'branch_logic_4', trigger_rule = 'none_skipped')
    def fn_branch_logic_4(**context):
        targets = []
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        if ((get_Status(context["dag_run"], "Cmd_PreSession_VZAI_AUDIT_LOAD")) == "succeeded") or ("disabled" != ""):
            targets.append(next(filter(lambda task_id: task_id.startswith('Wklt_EDM_DW_ALL_OTHER_DIMENSIONS.'), context['task'].downstream_task_ids), None))
        return targets

    branch_logic_4_task = fn_branch_logic_4()

    @task(task_id = 'Wklt_EDM_DW_ALL_OTHER_DIMENSIONS_param_init_logic')
    @provide_session
    def fn_Wklt_EDM_DW_ALL_OTHER_DIMENSIONS_param_init_logic(session=None, **context):
        task_qualifiers = list(context['task'].downstream_task_ids)[0].split(".")
        del task_qualifiers[-1]
        group_id = ".".join(task_qualifiers)
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        session_param_json = None
        variables = {}
        try:
            results = session.query(Variable).filter(Variable.key.like(f"{id + '.' + group_id}%")).all()
            variables = {var.key.replace(id + '.' + group_id + ".", "", 1): var.get_val() for var in results}
        finally:
            session.close()
    
        var = {
            "$s_m_EDM_DW_SSP_LATA_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LATA_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_LATA_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_ORDER_CLASS_DIM.FirstErrorMsg" : "",
            "$Start.StartTime" : None,
            "$Start.EndTime" : None,
            "$Start.Status" : None,
            "$Start.PrevTaskStatus" : None,
            "$Start.ErrorCode" : None,
            "$Start.ErrorMsg" : "",
            "$s_m_ODS_DW_SSP_RATE_DIM.StartTime" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.EndTime" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.Status" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.PrevTaskStatus" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.ErrorCode" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.ErrorMsg" : "",
            "$s_m_ODS_DW_SSP_RATE_DIM.SrcSuccessRows" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.SrcFailedRows" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.TgtSuccessRows" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.TgtFailedRows" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.TotalTransErrors" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.FirstErrorCode" : None,
            "$s_m_ODS_DW_SSP_RATE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_OPERATING_SYSTEM_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_LFA_TARCODE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_SUB_REGION_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_LINE_SPEED_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PAYMENT_TYPE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SUB_SYSTEM_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_LEAD_LIST_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_STATUS_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_FLOW_MAP_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_LINE_OF_BUSINESS_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_FLOW_STATUS_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_AGENCY_LOCATION_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_SUSPEND_REASON_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_FLOW_WORKGROUP_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_ORDER_TYPE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_TRANSACTION_TYPE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PRODUCT_TYPE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PACKAGE_PRODUCT_DIM.FirstErrorMsg" : "",
            "$Dcsn_Package_and_Product_finish.StartTime" : None,
            "$Dcsn_Package_and_Product_finish.EndTime" : None,
            "$Dcsn_Package_and_Product_finish.Status" : None,
            "$Dcsn_Package_and_Product_finish.PrevTaskStatus" : None,
            "$Dcsn_Package_and_Product_finish.ErrorCode" : None,
            "$Dcsn_Package_and_Product_finish.ErrorMsg" : "",
            "$Dcsn_Package_and_Product_finish.Condition" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_SOURCE_SYSTEM_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_ORDER_STATUS_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_MARKETS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_MARKETS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_MARKETS_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ISP_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ISP_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_ISP_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_MISS_APPOINTMENT_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_AGENCY_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_AGENCY_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_AGENCY_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_CANCEL_REASON_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_DISCONNECT_REASON_DIM.FirstErrorMsg" : "",
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.StartTime" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.EndTime" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.Status" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.PrevTaskStatus" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.ErrorCode" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.ErrorMsg" : "",
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.SrcSuccessRows" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.SrcFailedRows" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.TgtSuccessRows" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.TgtFailedRows" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.TotalTransErrors" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.FirstErrorCode" : None,
            "$s_m_ODS_DW_SSP_BSE_MASTER_COUPON.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_ORDER_SUBTYPE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_APPOINTMENT_CODE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_FLOW_FALLOUT_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_SERVICE_TYPE_DIM.FirstErrorMsg" : "",
            }
        for i in var.keys():
            Variable.set(id + '.' + group_id + '.' + i, var[i])

    Wklt_EDM_DW_ALL_OTHER_DIMENSIONS__init = fn_Wklt_EDM_DW_ALL_OTHER_DIMENSIONS_param_init_logic()

    Wklt_EDM_DW_ALL_OTHER_DIMENSIONS = prepare_Wklt_EDM_DW_ALL_OTHER_DIMENSIONS_TG(dag = dag, groupId = 'Wklt_EDM_DW_ALL_OTHER_DIMENSIONS', trigger = 'none_skipped', bq_project_id="{{ var.value.BQ_ProjectID }}", bq_project_pr_id="{{ var.value.BQ_ProjectID_PR }}")

    @task.branch(task_id = 'branch_logic_5', trigger_rule = 'none_skipped')
    def fn_branch_logic_5(**context):
        targets = []
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        if Variable.get(id + '.Wklt_EDM_DW_ALL_OTHER_DIMENSIONS.$JobStatus') == "succeeded":
            targets.append(next(filter(lambda task_id: task_id.startswith('Wklt_EDM_DW_FiOS_BOOKSHELF.'), context['task'].downstream_task_ids), None))
        if (Variable.get(id + '.Wklt_EDM_DW_ALL_OTHER_DIMENSIONS.$JobStatus') == "succeeded") or ("disabled" != ""):
            targets.append(next(filter(lambda task_id: task_id.startswith('Wklt_EDM_DW_SSP_BIZ_BUNDLES.'), context['task'].downstream_task_ids), None))
        return targets

    branch_logic_5_task = fn_branch_logic_5()

    @task(task_id = 'Wklt_EDM_DW_FiOS_BOOKSHELF_param_init_logic')
    @provide_session
    def fn_Wklt_EDM_DW_FiOS_BOOKSHELF_param_init_logic(session=None, **context):
        task_qualifiers = list(context['task'].downstream_task_ids)[0].split(".")
        del task_qualifiers[-1]
        group_id = ".".join(task_qualifiers)
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        session_param_json = None
        variables = {}
        try:
            results = session.query(Variable).filter(Variable.key.like(f"{id + '.' + group_id}%")).all()
            variables = {var.key.replace(id + '.' + group_id + ".", "", 1): var.get_val() for var in results}
        finally:
            session.close()
    
        var = {
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_COUPON_PRODUCTS_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM.FirstErrorMsg" : "",
            "$Start.StartTime" : None,
            "$Start.EndTime" : None,
            "$Start.Status" : None,
            "$Start.PrevTaskStatus" : None,
            "$Start.ErrorCode" : None,
            "$Start.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_COUPON_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_COUPON_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_COUPON_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_OFFER_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_OFFER_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_OFFER_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_OFFER_PRODUCTS_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_AFFINITY_DOMAINS_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PROMOTION_OFFER_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.StartTime" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.EndTime" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.Status" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.PrevTaskStatus" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.ErrorCode" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.ErrorMsg" : "",
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.SrcSuccessRows" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.SrcFailedRows" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.TgtSuccessRows" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.TgtFailedRows" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.TotalTransErrors" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.FirstErrorCode" : None,
            "$s_m_EDM_EDM_SSP_TV_PACKAGE_DIM_V1.FirstErrorMsg" : "",
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.StartTime" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.EndTime" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.Status" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.PrevTaskStatus" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.ErrorCode" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.ErrorMsg" : "",
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.SrcSuccessRows" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.SrcFailedRows" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.TgtSuccessRows" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.TgtFailedRows" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.TotalTransErrors" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.FirstErrorCode" : None,
            "$s_m_EDM_EDM_SSP_VOICE_PACKAGE_DIM_V1.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_TV_PACKAGE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_VOICE_PACKAGE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_TYPE_LOB_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUNDLE_COMPONENT_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.StartTime" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.EndTime" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.Status" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_CHANNEL_OFFER_DIM_UPDATE.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.StartTime" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.EndTime" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.Status" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_PROMO_OFFER_PRODUCT_DIM_UPDATE.FirstErrorMsg" : "",
            }
        for i in var.keys():
            Variable.set(id + '.' + group_id + '.' + i, var[i])

    Wklt_EDM_DW_FiOS_BOOKSHELF__init = fn_Wklt_EDM_DW_FiOS_BOOKSHELF_param_init_logic()

    Wklt_EDM_DW_FiOS_BOOKSHELF = prepare_Wklt_EDM_DW_FiOS_BOOKSHELF_TG(dag = dag, groupId = 'Wklt_EDM_DW_FiOS_BOOKSHELF', trigger = 'none_skipped', bq_project_id="{{ var.value.BQ_ProjectID }}", bq_project_pr_id="{{ var.value.BQ_ProjectID_PR }}")

    @task.branch(task_id = 'branch_logic_6', trigger_rule = 'none_skipped')
    def fn_branch_logic_6(**context):
        targets = []
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        if Variable.get(id + '.Wklt_EDM_DW_FiOS_BOOKSHELF.$JobStatus') == "succeeded":
            targets.append('Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS')
        return targets

    branch_logic_6_task = fn_branch_logic_6()

    # Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS = SSHOperator(
    #     task_id = 'Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS',
    #     ssh_hook = ssh_hook,
    #     command = """$ETL_HOME/ETL_SCRIPTS/SSP_DM_DIM/Bin/VZ_AI_DIM_LOAD_teradata.ksh  Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS SSP_DIM SUCCESS """,
    #     conn_timeout = 60,
    #     get_pty = False,
    #     retries = 0,
    #     cmd_timeout = None,
    #     environment = {
    #       'run_id': "{{ dag_run.run_id | lower | replace(':', '') | replace('+', '') | replace('.', '') | replace('-', '') | replace('T', '') }}",
    #       'instance_name': "{{ var.value.INSTANCE_NAME }}",
    #       'job_id': "{{ dag.dag_id }}",
    #       'task_id': 'cmd_vzai_audit_edm_success_all_other_dims',
    #       'task_type': 'sshoperator'
    #     },
    #     doc_md = "",
    #     trigger_rule = 'all_success',
    # )



    Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS = VZ_AI_DIM_LOAD_teradata.override(task_id='Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS', trigger_rule='all_success')(
        process_nm='Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS',
        sys_cd='SSP_DIM',
        status='SUCCESS'
    )

    @task.branch(task_id = 'branch_logic_7', trigger_rule = 'none_skipped')
    def fn_branch_logic_7(**context):
        targets = []
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        if (get_Status(context["dag_run"], "Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS")) == "succeeded":
            targets.append('Cmd_EDMLOAD_DONE')
        return targets

    branch_logic_7_task = fn_branch_logic_7()

    # Cmd_EDMLOAD_DONE = SSHOperator(
    #     task_id = 'Cmd_EDMLOAD_DONE',
    #     ssh_hook = ssh_hook,
    #     command = """/usr/bin/touch $ETL_HOME/ETL_SCRIPTS/SSP_DM_DIM/Bin/EDM_LOAD_DONE """,
    #     conn_timeout = 60,
    #     get_pty = False,
    #     retries = 0,
    #     cmd_timeout = None,
    #     environment = {
    #       'run_id': "{{ dag_run.run_id | lower | replace(':', '') | replace('+', '') | replace('.', '') | replace('-', '') | replace('T', '') }}",
    #       'instance_name': "{{ var.value.INSTANCE_NAME }}",
    #       'job_id': "{{ dag.dag_id }}",
    #       'task_id': 'cmd_edmload_done',
    #       'task_type': 'sshoperator'
    #     },
    #     doc_md = "",
    #     trigger_rule = 'all_success',
    # )

    Cmd_EDMLOAD_DONE = PythonOperator(
        task_id = 'cmd_edmload_done',
        trigger_rule = 'all_success',
        python_callable = create_touch_file,
        op_kwargs={
            "object_name": "non_dpf/mapping_output_as_file/sysmnt/etl/etlcfs02scriptsSSP_DM_DIM/Bin/EDM_LOAD_DONE_{{ ds_nodash }}"
        }
    )

    @task(task_id = 'Wklt_EDM_DW_SSP_BIZ_BUNDLES_param_init_logic')
    @provide_session
    def fn_Wklt_EDM_DW_SSP_BIZ_BUNDLES_param_init_logic(session=None, **context):
        task_qualifiers = list(context['task'].downstream_task_ids)[0].split(".")
        del task_qualifiers[-1]
        group_id = ".".join(task_qualifiers)
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        session_param_json = None
        variables = {}
        try:
            results = session.query(Variable).filter(Variable.key.like(f"{id + '.' + group_id}%")).all()
            variables = {var.key.replace(id + '.' + group_id + ".", "", 1): var.get_val() for var in results}
        finally:
            session.close()
    
        var = {
            "$Start.StartTime" : None,
            "$Start.EndTime" : None,
            "$Start.Status" : None,
            "$Start.PrevTaskStatus" : None,
            "$Start.ErrorCode" : None,
            "$Start.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_BILL_CYCLE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_END_CLIENT_SYSTEM_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUS_BUNDLE_TYPE_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_REGION_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_REGION_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_REGION_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUS_MARKET_BUNDLES_DIM.FirstErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.StartTime" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.EndTime" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.Status" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.PrevTaskStatus" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.ErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.ErrorMsg" : "",
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.SrcSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.SrcFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.TgtSuccessRows" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.TgtFailedRows" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.TotalTransErrors" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.FirstErrorCode" : None,
            "$s_m_EDM_DW_SSP_BUS_MKT_BNDL_PDCTS_DIM.FirstErrorMsg" : "",
            }
        for i in var.keys():
            Variable.set(id + '.' + group_id + '.' + i, var[i])

    Wklt_EDM_DW_SSP_BIZ_BUNDLES__init = fn_Wklt_EDM_DW_SSP_BIZ_BUNDLES_param_init_logic()

    Wklt_EDM_DW_SSP_BIZ_BUNDLES = prepare_Wklt_EDM_DW_SSP_BIZ_BUNDLES_TG(dag = dag, groupId = 'Wklt_EDM_DW_SSP_BIZ_BUNDLES', trigger = 'none_skipped', bq_project_id="{{ var.value.BQ_ProjectID }}", bq_project_pr_id="{{ var.value.BQ_ProjectID_PR }}")

    @task.branch(task_id = 'branch_logic_8', trigger_rule = 'none_skipped')
    def fn_branch_logic_8(**context):
        targets = []
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        if (Variable.get(id + '.Wklt_EDM_DW_SSP_BIZ_BUNDLES.$JobStatus') == "succeeded") or ("disabled" != ""):
            targets.append('Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS')
        return targets

    branch_logic_8_task = fn_branch_logic_8()

    dag_status = DMStatusOperator(
        task_id = 'dag_status',
        group_id = None,
        trigger_rule = 'all_done',
    )

    @task(task_id = 'variable_cleanup', trigger_rule = 'all_success')
    @provide_session
    def fn_variable_cleanup(session=None,**context):
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id) + '.'
        session.query(Variable).filter(Variable.key.contains(id)).delete(synchronize_session = False)

    variable_cleanup = fn_variable_cleanup()


Start >> dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions_ingestion >> branch_logic_1_task >> Cmd_EDM_DW_Generate_par >> branch_logic_2_task >> Event_ODS_EDM_ALL_OTHER >> branch_logic_3_task >> Cmd_PreSession_VZAI_AUDIT_LOAD >> branch_logic_4_task >> Wklt_EDM_DW_ALL_OTHER_DIMENSIONS >> branch_logic_5_task
branch_logic_5_task >> Wklt_EDM_DW_FiOS_BOOKSHELF >> branch_logic_6_task >> Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS >> branch_logic_7_task >> Cmd_EDMLOAD_DONE >> dag_status >> variable_cleanup
branch_logic_5_task >> Wklt_EDM_DW_SSP_BIZ_BUNDLES >> branch_logic_8_task >> Cmd_VZAI_AUDIT_EDM_SUCCESS_ALL_OTHER_DIMS
Wklt_EDM_DW_ALL_OTHER_DIMENSIONS__init >> Wklt_EDM_DW_ALL_OTHER_DIMENSIONS
Wklt_EDM_DW_FiOS_BOOKSHELF__init >> Wklt_EDM_DW_FiOS_BOOKSHELF
Wklt_EDM_DW_SSP_BIZ_BUNDLES__init >> Wklt_EDM_DW_SSP_BIZ_BUNDLES



---------------------------
error
----------
default-hostname
*** Reading remote logs from Cloud Logging.
[2026-01-22, 19:47:03 UTC] {local_task_job_runner.py:123}  Pre task execution logs
[2026-01-22, 19:47:10 UTC] {base.py:84} INFO - Retrieving connection 'sa-vz-it-gk1v-edwdo-0-app'
[2026-01-22, 19:47:10 UTC] {bigquery.py:2391} INFO - Executing: {'query': {'query': '\n-- view(s) name replaced:\n-- mdr_ods_tblsv.master_coupon=mdr_ods.master_coupon\n-- dw_ssp_tblsv.ssp_bse_master_coupon=dw_ssp.ssp_bse_master_coupon\n\n\n-- Declaration of params:\n-- START_DATE=04/18/2024\n-- END_DATE=04/19/2024\n\n-- Edited\n\n\nCREATE OR REPLACE TABLE vz-it-pr-gk1v-pleedwdo-0.aedw360_tbls.__tmp__m_ods_dw_ssp_bse_master_coupon0 (lkp_coupon_cd STRING(50), coupon_cd STRING(10),\nlead_list_info STRING(1000), file_idf STRING(30), coupon_type STRING(30), coupon_stat STRING(30), create_dt datetime, redeemed_dt datetime, expiry_dt\ndatetime, ban STRING(50), blg_tel_no STRING(10), sqe_adrs_id STRING(50), zip_code NUMERIC(9,0), prfl_isoc STRING(2000), dim_src_cd STRING(10),\ndim_last_mdfd_dt datetime);\n\nBEGIN\nDECLARE START_DATE STRING DEFAULT \'\';\nDECLARE END_DATE STRING DEFAULT \'\';\nBEGIN TRANSACTION;\n\n -- MAIN SQL --\nINSERT INTO vz-it-pr-gk1v-pleedwdo-0.aedw360_tbls.__tmp__m_ods_dw_ssp_bse_master_coupon0 (lkp_coupon_cd, coupon_cd, lead_list_info, file_idf, coupon_type,\n  coupon_stat, create_dt, redeemed_dt, expiry_dt, ban, blg_tel_no, sqe_adrs_id, zip_code, prfl_isoc, dim_src_cd, dim_last_mdfd_dt)\n(WITH \n--SQ_MASTER_COUPON [Source Qualifier]\nsq_master_coupon AS (SELECT coupon_cd,\n        lead_list_info,\n        file_idf,\n        coupon_type,\n        coupon_stat,\n        create_dt,\n        redeemed_dt,\n        expiry_dt,\n        ban,\n        blg_tel_no,\n        sqe_adrs_id,\n        zip_code,\n        prfl_isoc,\n        ods_src_cd,\n        ods_last_mdfd_dt\n      FROM vz-it-pr-gk1v-pleedwdo-0.mdr_ods.master_coupon\n      WHERE master_coupon.ODS_LAST_MDFD_DT BETWEEN  PARSE_DATE(\'%m/%d/%Y\',START_DATE ) and  PARSE_DATE(\'%m/%d/%Y\',END_DATE)) \n(SELECT t4.coupon_cd AS\n        lkp_coupon_cd,\n        TRIM(t0.coupon_cd) AS coupon_cd,\n        t0.lead_list_info,\n        t0.file_idf,\n        t0.coupon_type,\n        t0.coupon_stat,\n        t0.create_dt,\n        CAST(t0.redeemed_dt AS datetime) AS redeemed_dt,\n        CAST(t0.expiry_dt AS datetime) AS expiry_dt,\n        t0.ban,\n        t0.blg_tel_no,\n        t0.sqe_adrs_id,\n        CAST(t0.zip_code AS numeric) AS zip_code,\n        t0.prfl_isoc,\n        \'ODS\' AS dim_src_cd,\n        CURRENT_DATETIME() AS dim_last_mdfd_dt\n      FROM sq_master_coupon AS t0\n        LEFT JOIN (SELECT coupon_cd\n          FROM vz-it-pr-gk1v-pleedwdo-0.dw_ssp.ssp_bse_master_coupon\n          QUALIFY (ROW_NUMBER() OVER (PARTITION BY coupon_cd)) = 1) AS t4 ON t4.coupon_cd = TRIM(t0.coupon_cd)));\n\n/** \nThe stages covered in this file are :\n\n|UPD_SSP_BSE_MASTER_COUPON (Target Definition)\n|--UPD_SSP_BSE_MASTER_COUPON (Update strategy)\n|----RTR_INSERT_UPDATE (Router)\n|------LKP_SSP_BSE_MASTER_COUPON (Lookup Procedure)\n|--------EXP_INSERT_VALUES (Expression)\n|----------SQ_MASTER_COUPON (Source Qualifier)\n|------------MASTER_COUPON (Source Definition)\n **/--;\n\n -- MAIN SQL --\nUPDATE vz-it-pr-gk1v-pleedwdo-0.dw_ssp.ssp_bse_master_coupon SET\n  dim_last_mdfd_dt = t1.dim_last_mdfd_dt FROM (SELECT lkp_coupon_cd AS coupon_cd,\n    dim_last_mdfd_dt\n  FROM vz-it-pr-gk1v-pleedwdo-0.aedw360_tbls.__tmp__m_ods_dw_ssp_bse_master_coupon0\n  WHERE lkp_coupon_cd IS NOT NULL) AS t1\nWHERE t1.coupon_cd = ssp_bse_master_coupon.coupon_cd;\n\n/** \nThe stages covered in this file are :\n\n|INS_SSP_BSE_MASTER_COUPON (Target Definition)\n|--RTR_INSERT_UPDATE (Router)\n|----LKP_SSP_BSE_MASTER_COUPON (Lookup Procedure)\n|------EXP_INSERT_VALUES (Expression)\n|--------SQ_MASTER_COUPON (Source Qualifier)\n|----------MASTER_COUPON (Source Definition)\n **/--;\n\n -- MAIN SQL --\nINSERT INTO vz-it-pr-gk1v-pleedwdo-0.dw_ssp.ssp_bse_master_coupon (coupon_cd, lead_list_info, file_idf, coupon_type, coupon_stat, create_dt, redeemed_dt,\n  expiry_dt, ban, blg_tel_no, sqe_adrs_id, zip_code, prfl_isoc, dim_src_cd, dim_last_mdfd_dt)\nSELECT DISTINCT CAST(coupon_cd AS string) AS coupon_cd,\n    lead_list_info,\n    file_idf,\n    coupon_type,\n    coupon_stat,\n    create_dt,\n    CAST(redeemed_dt AS DATE) AS redeemed_dt,\n    CAST(expiry_dt AS 
[2026-01-22, 19:47:10 UTC] {bigquery.py:2391} INFO - DATE) AS expiry_dt,\n    ban,\n    blg_tel_no,\n    sqe_adrs_id,\n    CAST(zip_code AS int64) AS zip_code,\n    prfl_isoc,\n    CAST(dim_src_cd AS string) AS dim_src_cd,\n    dim_last_mdfd_dt\n  FROM vz-it-pr-gk1v-pleedwdo-0.aedw360_tbls.__tmp__m_ods_dw_ssp_bse_master_coupon0\n  WHERE lkp_coupon_cd IS NULL\n  EXCEPT DISTINCT\n  SELECT *\n  FROM vz-it-pr-gk1v-pleedwdo-0.dw_ssp.ssp_bse_master_coupon;\n\nCOMMIT TRANSACTION;\nEXCEPTION WHEN ERROR\n  THEN\n  RAISE USING message=concat("Exception while running query : ", FORMAT(@@error.message), @@error.formatted_stack_trace);\n  ROLLBACK TRANSACTION;\nEND;\n\nDROP TABLE vz-it-pr-gk1v-pleedwdo-0.aedw360_tbls.__tmp__m_ods_dw_ssp_bse_master_coupon0;\n', 'useLegacySql': False, 'params': {'BQ_ProjectID': 'vz-it-pr-gk1v-pleedwdo-0', 'BQ_ProjectID_PR': 'vz-it-pr-gk1v-pleedwpr-0'}}, 'labels': {'run_id': 'manual__20260122t1526504638000000', 'instance_name': 'vz-it-pr-wdwg-pleaidcom-0', 'job_id': 'wkfl_edm_dw_all_other_dimensions', 'task_id': 'm_ods_dw_ssp_bse_master_coupon', 'task_type': 'bq_to_bq_load'}}'
[2026-01-22, 19:47:10 UTC] {credentials_provider.py:410} INFO - Getting connection using `google.auth.default()` since no explicit credentials are provided.
[2026-01-22, 19:47:10 UTC] {bigquery.py:1268} INFO - Inserting job Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS_m_ODS_DW_SSP_BSE_MASTER_COUPON_c5cf827a1f2d45af1c4ba8915a93b176
[2026-01-22, 19:47:11 UTC] {bigquery.py:75} INFO - Using the connection  sa-vz-it-gk1v-edwdo-0-app .
[2026-01-22, 19:47:11 UTC] {taskinstance.py:289} INFO - Pausing task as DEFERRED. dag_id=dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions, task_id=Wklt_EDM_DW_ALL_OTHER_DIMENSIONS.s_m_ODS_DW_SSP_BSE_MASTER_COUPON.m_ODS_DW_SSP_BSE_MASTER_COUPON, run_id=manual__2026-01-22T15:26:50.463800+00:00, execution_date=20260122T152650, start_date=20260122T194704
[2026-01-22, 19:47:11 UTC] {taskinstance.py:341}  Post task execution logs
[2026-01-22, 19:47:29 UTC] {local_task_job_runner.py:123}  Pre task execution logs
[2026-01-22, 19:47:31 UTC] {taskinstance.py:3315} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/opt/python3.11/lib/python3.11/site-packages/airflow/models/taskinstance.py", line 769, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/python3.11/lib/python3.11/site-packages/airflow/models/taskinstance.py", line 735, in _execute_callable
    return ExecutionCallableRunner(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/python3.11/lib/python3.11/site-packages/airflow/utils/operator_helpers.py", line 252, in run
    return self.func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/python3.11/lib/python3.11/site-packages/airflow/models/baseoperator.py", line 1838, in resume_execution
    return execute_callable(context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/python3.11/lib/python3.11/site-packages/airflow/providers/google/cloud/operators/bigquery.py", line 2495, in execute_complete
    raise AirflowException(event["message"])
airflow.exceptions.AirflowException: Exception while running query : Query error: Failed to parse input string "" at [25:1]At [25:1]
 at [126:3]
[2026-01-22, 19:47:31 UTC] {taskinstance.py:1227} INFO - Marking task as FAILED. dag_id=dg_gk1v_edwdo_wln_mdr_ssp_wkfl_edm_dw_all_other_dimensions, task_id=Wklt_EDM_DW_ALL_OTHER_DIMENSIONS.s_m_ODS_DW_SSP_BSE_MASTER_COUPON.m_ODS_DW_SSP_BSE_MASTER_COUPON, run_id=manual__2026-01-22T15:26:50.463800+00:00, execution_date=20260122T152650, start_date=20260122T194704, end_date=20260122T194731
[2026-01-22, 19:47:32 UTC] {taskinstance.py:341}  Post task execution logs
--------------------------
import sys
# sys.path.append('/home/airflow/gcs/dags/vz-it-gk1v-edwdo-0/')
sys.path.append('/home/airflow/gcs/dags/vz-it-gk1v-edwdo-0/informatica/aedw-mdr-dw-ssp-datamart-edm')
from airflow.models import Variable
import airflow
from airflow import DAG
from airflow.utils.task_group import TaskGroup
from airflow.providers.google.cloud.operators.bigquery import BigQueryInsertJobOperator
import os
from airflow.providers.google.common.hooks.base_google import GoogleBaseHook
from google.cloud import bigquery
from operators.dm_status import DMStatusOperator
# abs_path ='/home/airflow/gcs/data/sql/'
abs_path ='/home/airflow/gcs/data/sql/informatica/aedw-mdr-dw-ssp-datamart-edm/'
import re

def get_row_stats(context):
    task_id = context["task"].task_id
    # default conn_id = google_cloud_default
    hook = GoogleBaseHook(gcp_conn_id=Variable.get('GCP_CONNECTION_ID'))
    credentials = hook.get_credentials()
    client = bigquery.Client(credentials=credentials)
    job_id = context["ti"].xcom_pull(task_ids=task_id, key='return_value')
    job = client.get_job(job_id, location="us", project=Variable.get('BQ_ProjectID'))
    child_jobs = list(client.list_jobs(parent_job=job.job_id, project=job.project))

    if child_jobs:
        for child in child_jobs:
            set_job_stats(child, context, client)
    else:
        set_job_stats(job, context, client)

def set_job_stats(job, context, client):
    # fetch tgt row count
    if job.destination and "__tmp__" not in job.destination.table_id:
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        tgt_row_count = Variable.get(id + '.' + context["task"].task_group.group_id + '.TgtSuccessRows', default_var=0)
        current_tgt_row_count = job.dml_stats.inserted_row_count if job.dml_stats else 0
        tgt_row_count = int(tgt_row_count) + current_tgt_row_count
        Variable.set(id + '.' + context["task"].task_group.group_id + '.TgtSuccessRows', tgt_row_count)
    
    # fetch src row count
    if job.destination or job.referenced_tables:
        id = context['dag_run'].dag_id + '_' + str(context['dag_run'].id)
        src_row_count = Variable.get(id + '.' + context["task"].task_group.group_id + '.SrcSuccessRows', default_var=0)
        src_tables = [
            table
            for table in job.referenced_tables
            if job.destination and table.table_id != job.destination.table_id and "__tmp__" not in table.table_id
        ]
        if src_tables == []:
            src_tables.append(job.destination)
        for table in src_tables:
            table_name = table.table_id
            project = table.project
            dataset = table.dataset_id
            
            try:
                table_ref = client.get_table(f"{project}.{dataset}.{table_name}")
                current_src_row_count = table_ref.num_rows
                src_row_count = int(src_row_count) + current_src_row_count
                Variable.set(id + '.' + context["task"].task_group.group_id + '.SrcSuccessRows', src_row_count)
            except Exception as e:
                print(f"Failed to fetch row count for {table_name}: {e}")


def prepare_s_m_ODS_DW_SSP_BSE_MASTER_COUPON_TG(groupId, trigger = 'all_success', parent_group = None, dag: DAG = None, userStatus = None, bq_project_id = None, bq_project_pr_id = None) -> TaskGroup:
    with TaskGroup(group_id = groupId, default_args = dag.default_args if dag else parent_group.default_args) as task_group:
        m_ODS_DW_SSP_BSE_MASTER_COUPON = BigQueryInsertJobOperator(
                task_id = 'm_ODS_DW_SSP_BSE_MASTER_COUPON',
                project_id = bq_project_id,
                configuration = {
                        'query': {
                                'query': open(os.path.join(abs_path,"wkfl_edm_dw_all_other_dimensions/wklt_edm_dw_all_other_dimensions/s_m_ods_dw_ssp_bse_master_coupon/m_ods_dw_ssp_bse_master_coupon","m_ods_dw_ssp_bse_master_coupon.sql"), "r").read().format(task_group.group_id),
                                'useLegacySql': False, 'params': {'BQ_ProjectID': bq_project_id, 'BQ_ProjectID_PR': bq_project_pr_id}
                        } ,
                        'labels': {
                                'run_id': "{{ dag_run.run_id | lower | replace(':', '') | replace('+', '') | replace('.', '') | replace('-', '') | replace('T', '') }}",
                                'instance_name': "{{ var.value.INSTANCE_NAME }}",
                                'job_id' : 'wkfl_edm_dw_all_other_dimensions',
                                'task_id': 'm_ods_dw_ssp_bse_master_coupon',
                                'task_type': 'bq_to_bq_load'
                        }
                },
                gcp_conn_id = Variable.get('GCP_CONNECTION_ID'),
                job_id = 'Wkfl_EDM_DW_ALL_OTHER_DIMENSIONS_m_ODS_DW_SSP_BSE_MASTER_COUPON',
                deferrable = True,
                on_success_callback = get_row_stats,
                trigger_rule = trigger,
        )

        status = DMStatusOperator(
                task_id = 'status',
                group_id = task_group.group_id,
                jobName = 'm_ODS_DW_SSP_BSE_MASTER_COUPON',
                userStatus = userStatus,
                trigger_rule = 'all_done',
        )


        m_ODS_DW_SSP_BSE_MASTER_COUPON >> status
    return task_group

------------------------
